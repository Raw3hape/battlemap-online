<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a0a0a">
    
    <title>BattleMap Online</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üó∫Ô∏è</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üó∫Ô∏è</text></svg>">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- –ù–∞—à–∏ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="/public/css/main-mobile.css">
</head>
<body data-theme="dark">
    <!-- –ö–∞—Ä—Ç–∞ –∏ –∫–∞–Ω–≤–∞—Å—ã -->
    <div id="map"></div>
    <canvas id="fogCanvas"></canvas>
    <canvas id="gridCanvas"></canvas>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é -->
    <button class="menu-button" onclick="window.battleMap && window.battleMap.toggleMenu()">‚ò∞</button>
    
    <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
    <div class="side-menu" id="sideMenu">
        <div class="menu-header">
            <h2>BattleMap Online</h2>
            <p style="font-size: 11px; opacity: 0.6;">–†–∞—Å–∫—Ä–æ–π –∫–∞—Ä—Ç—É –º–∏—Ä–∞ –≤–º–µ—Å—Ç–µ!</p>
        </div>
        
        <div class="menu-section">
            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            <div class="menu-item" onclick="window.battleMap && window.battleMap.toggleTheme()">
                <span>üé® –¢–µ–º–∞</span>
                <span id="themeStatus">–¢–µ–º–Ω–∞—è</span>
            </div>
            <div class="menu-item">
                <span>üó∫Ô∏è –°—Ç–∏–ª—å –∫–∞—Ä—Ç—ã</span>
                <select id="mapStyleMenu" onchange="window.battleMap && window.battleMap.changeMapStyle(this.value)" style="background: transparent; color: inherit; border: none; font-size: 12px;">
                    <option value="osm">OpenStreetMap</option>
                    <option value="hot">OSM HOT</option>
                    <option value="topo">–¢–æ–ø–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è</option>
                    <option value="cycle">–í–µ–ª–æ—Å–∏–ø–µ–¥–Ω–∞—è</option>
                    <option value="positron">CartoDB Light</option>
                    <option value="dark">CartoDB Dark</option>
                    <option value="satellite">–°–ø—É—Ç–Ω–∏–∫</option>
                    <option value="wikimedia">Wikimedia</option>
                </select>
            </div>
            <div class="menu-item" onclick="window.battleMap && window.battleMap.toggleGrid()">
                <span>‚äû –°–µ—Ç–∫–∞</span>
                <span id="gridStatus">ON</span>
            </div>
        </div>
        
        <div class="menu-section">
            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
            <div class="menu-item" onclick="window.battleMap && window.battleMap.resetFog()">
                <span>‚Ü∫ –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</span>
            </div>
            <div class="menu-item" onclick="window.battleMap && window.battleMap.saveProgress()">
                <span>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
            </div>
            <div class="menu-item" onclick="window.battleMap && window.battleMap.loadProgress()">
                <span>üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å</span>
            </div>
        </div>
        
        <div class="menu-section">
            <h3>–û—Ç–ª–∞–¥–∫–∞</h3>
            <div class="menu-item" onclick="window.battleMap && window.battleMap.toggleLogsPanel()">
                <span>üìã –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏</span>
            </div>
            <div class="menu-item" onclick="window.battleMap && (window.battleMap.logLevel = window.battleMap.logLevel === 'debug' ? 'info' : 'debug', window.battleMap.log('–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤: ' + window.battleMap.logLevel, 'info'))">
                <span>üîß Debug —Ä–µ–∂–∏–º</span>
                <span id="debugStatus">OFF</span>
            </div>
        </div>
        
        <div class="menu-section">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div class="menu-item">
                <span>üìç –õ–æ–∫–∞—Ü–∏—è</span>
                <span id="currentLocation" style="font-size: 10px;">-</span>
            </div>
            <div class="menu-item">
                <span>üåç –ó—É–º</span>
                <span id="zoomLevel">10</span>
            </div>
            <div class="menu-item">
                <span>üìê –°–µ—Ç–∫–∞</span>
                <span id="cellSize">10 –∫–º</span>
            </div>
        </div>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å –ª–æ–≥–æ–≤ -->
    <div class="logs-panel" id="logsPanel">
        <div class="logs-header">
            <h3>üìã –õ–æ–≥–∏</h3>
            <div class="logs-controls">
                <button onclick="window.battleMap && window.battleMap.copyLogs()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button onclick="window.battleMap && window.battleMap.clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                <button onclick="window.battleMap && window.battleMap.toggleLogsPanel()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
        <div class="logs-content" id="logsContent"></div>
    </div>
    
    
    <!-- UI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="ui-container">
        <!-- –õ–æ–∫–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞ -->
        <div class="stats">
            <div class="stat-item">
                <span class="stat-label">–ú–æ–∏ –∫–º¬≤</span>
                <span class="stat-value" id="areaRevealed">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">–ú–æ–∏ –∫–ª–µ—Ç–∫–∏</span>
                <span class="stat-value" id="cellsRevealed">0</span>
            </div>
        </div>
        
        <!-- –û–±—â–∞—è –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="online-stats">
            <div class="online-stat-item">
                <span class="online-stat-label">–í—Å–µ–≥–æ –∫–ª–µ—Ç–æ–∫</span>
                <span class="online-stat-value" id="totalCells">0</span>
            </div>
            <div class="online-stat-item">
                <span class="online-stat-label">–ò–≥—Ä–æ–∫–æ–≤</span>
                <span class="online-stat-value" id="onlinePlayers">1</span>
            </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –∑—É–º –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö) -->
        <div class="controls">
            <button class="control-btn" onclick="window.battleMap && window.battleMap.map.zoomIn()">+</button>
            <button class="control-btn" onclick="window.battleMap && window.battleMap.map.zoomOut()">‚àí</button>
        </div>
        
        <!-- –¢–æ–ø —Å—Ç—Ä–∞–Ω -->
        <div class="top-countries" id="topCountries">
            <h3>üèÜ –¢–æ–ø —Å—Ç—Ä–∞–Ω</h3>
            <div id="countriesList"></div>
        </div>
    </div>
    
    <div class="sync-status" id="syncStatus">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...</div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Google Maps style controls -->
    <script src="/public/js/battlemap-googlemaps.js"></script>
    
    <script>
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑—É–º–∞ –Ω–∞ iOS
        document.addEventListener('touchmove', function(e) {
            if (e.scale !== 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                if (window.battleMap && window.battleMap.map) {
                    window.battleMap.map.invalidateSize();
                    window.battleMap.render();
                }
            }, 100);
        });
    </script>
</body>
</html>